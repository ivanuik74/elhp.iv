<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>elhp.iv — Публичная лента</title>
<style>
body {margin:0; font-family:'Segoe UI',sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; height:100vh;}

/* Логотип */
#logo {
  display:flex; align-items:center; justify-content:center; padding:10px; background:#222; border-bottom:1px solid #333;
}
#logo img { height:40px; margin-right:10px; }
#logo span { font-size:1.2em; font-weight:bold; }

/* Вход */
#loginDiv {display:flex;flex-direction:column;justify-content:center;align-items:center;flex:1;}
input,button{padding:10px;border-radius:6px;border:none;margin:5px 0;width:90%;max-width:300px;background:#222;color:#fff;}
button{cursor:pointer;background:#444;}
button:hover{background:#555;}

/* Чат */
#chatDiv{display:none;flex:1;flex-direction:column;height:100%;}
#chatTitle{background:#222;padding:10px;text-align:center;font-weight:bold;border-bottom:1px solid #333;}
#messages{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;}
.message{max-width:70%;margin:5px 0;padding:10px;border-radius:15px;background:#222;word-break:break-word;animation:fadeIn 0.2s;}
.message.you{background:#333;align-self:flex-end;}
.message .id{font-weight:bold;color:#aaa;margin-right:5px;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* Поле ввода */
#inputArea{display:flex;padding:5px;background:#222;}
#textInput{flex:1;padding:10px;border:none;border-radius:6px;background:#333;color:#fff;margin-right:5px;}
#sendBtn{padding:10px 20px;border:none;border-radius:6px;background:#444;cursor:pointer;}

/* Подпись авторов */
#footer{padding:5px;text-align:center;font-size:0.8em;color:#888;background:#111;border-top:1px solid #222;}

@media(max-width:600px){
  #messages{padding:5px;}
  #textInput{font-size:16px;}
  #sendBtn{font-size:16px;}
}
</style>
</head>
<body>

<!-- Логотип -->
<div id="logo">
  <img src="https://via.placeholder.com/40" alt="elhp.iv">
  <span>elhp.iv</span>
</div>

<!-- Вход -->
<div id="loginDiv">
  <h2>Выбери ник (A-Z, a-z, цифры, _)</h2>
  <input type="text" id="nickname" placeholder="Ник">
  <button id="loginBtn">Войти</button>
</div>

<!-- Чат -->
<div id="chatDiv">
  <div id="chatTitle">#Лента</div>
  <div id="messages"></div>
  <div id="inputArea">
    <input type="text" id="textInput" placeholder="Напишите сообщение...">
    <button id="sendBtn">Отправить</button>
  </div>
</div>

<!-- Подпись авторов -->
<div id="footer">Сделано ivanuik74 и karweqks</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ==== Firebase config ====
const firebaseConfig = {
  apiKey: "AIzaSyBnI40Y9ti3bnsgPAYg4G9zaM1J8qkk1z8",
  authDomain: "elhp-iv.firebaseapp.com",
  projectId: "elhp-iv",
  storageBucket: "elhp-iv.firebasestorage.app",
  messagingSenderId: "457553204800",
  appId: "1:457553204800:web:a9ae88735115a76c66b1a5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = null;
let messagesDiv = document.getElementById("messages");

// Проверка ника
function isValidNick(nick){ return /^[A-Za-z0-9_]{3,20}$/.test(nick); }

// Проверка localStorage
let storedNick = localStorage.getItem("nickname");
if(storedNick){ currentUser = { nickname: storedNick }; showChat(); }

// Вход / регистрация
document.getElementById("loginBtn").addEventListener("click", ()=>{
  let nick = document.getElementById("nickname").value.trim();
  if(!isValidNick(nick)) return alert("Ник 3-20 символов, A-Z, a-z, цифры, _");
  currentUser = { nickname: nick };
  localStorage.setItem("nickname", nick);
  showChat();
});

// Показ чата и запуск слушателя сообщений
function showChat(){
  document.getElementById("loginDiv").style.display = "none";
  document.getElementById("chatDiv").style.display = "flex";
